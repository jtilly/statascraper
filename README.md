# statascraper
[![Build Status](https://travis-ci.org/jtilly/statascraper.svg?branch=master)](https://travis-ci.org/jtilly/statascraper)

R Package that extracts tables from STATA log files

This package scrapes STATA log files, looks for tables generated by `tab`, `tabstat`, `list`,  `reg`, and `areg` and then returns these tables as R matrices or stores them as comma separated value files. This package can be useful, when researchers (have to) use STATA to work with data sets but want to use R to analyze and display results.

## Installation

``` r
# install.packages("devtools")
devtools::install_github("jtilly/statascraper")
```

## Example

Suppose you have the following STATA do file:

``` stata
log using "test.log", replace
webuse auto.dta

di "tab2r tab.RData"
tab make foreign
di "tab2r tabsum.RData"
tab foreign, sum(mpg)
di "tabstat2r tabstat.RData"
tabstat mpg, by(foreign) stats(mean sd p25 p50 p75)
di "list2r list.RData"
list price mpg

log close
```

Note that we use STATA's display command `di` before `tab`, `tabstat`, and `list` to place markers in the logfile that tell `statascraper` which tables to scrape and where to store the resulting `RData` or `csv` files. For instance, `tab2r tab.RData` tells the scraper to scrape the results from `tab` and store them in the file `tab.RData`. 

We now use `statascraper` to scrape the resulting [log file](https://github.com/jtilly/statascraper/blob/master/inst/example/test.log) so that we can use `R` to process the results.

``` r
# scraper.R
library("statascraper")

# point to stata log file
logfile = paste(system.file("example", package = "statascraper"), "test.log", sep = .Platform$file.sep)

# In this example, we scrape the Stata log file "test.log" that was created by
# "stata.do"

# read tab commands
read.tab(filename = logfile, outdir = ".", RData = TRUE, tag = "tab2r")
#> [1] "Created tab.RData"
#> [1] "Created tabsum.RData"
head(load.RData("tab.RData"))
#>             Domestic Foreign Total
#> AMC Concord        1       0     1
#> AMC Pacer          1       0     1
#> AMC Spirit         1       0     1
#> Audi 5000          0       1     1
#> Audi Fox           0       1     1
#> BMW 320i           0       1     1
head(load.RData("tabsum.RData"))
#>             Means Std..Dev. Freq.
#> Domestic 19.82692  4.743297    52
#> Foreign  24.77273  6.611187    22

# read tabstat commands
read.tabstat(filename = logfile, outdir = ".", RData = TRUE, tag = "tabstat2r")
#> [1] "Created tabstat.RData"
head(load.RData("tabstat.RData"))
#>              mean       sd  p25  p50 p75
#> Domestic 19.82692 4.743297 16.5 19.0  22
#> Foreign  24.77273 6.611187 21.0 24.5  28

# read list commands
read.list(filename = logfile, outdir = ".", RData = TRUE, tag = "list2r")
#> [1] "Created list.RData"
head(load.RData("list.RData"))
#>   price mpg
#> 1  4099  22
#> 2  4749  17
#> 3  3799  22
#> 4  4816  20
#> 5  7827  15
#> 6  5788  18
```
